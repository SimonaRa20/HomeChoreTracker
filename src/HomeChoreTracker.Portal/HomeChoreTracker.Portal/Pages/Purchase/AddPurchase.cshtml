@page "{id:int}"
@model HomeChoreTracker.Portal.Pages.Purchase.AddPurchaseModel
@{
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

@section HeadContent
{
    <title>@ViewData["Title"] - Home Chore Tracker</title>
    <link href="~/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" asp-append-version="true">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
          rel="stylesheet" asp-append-version="true">
    <link href="~/css/sb-admin-2.min.css" rel="stylesheet" asp-append-version="true">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
}
<div class="row">
    <div class="col-lg-12">
<a class="btn btn-light btn-sm" href="/Purchase/@Model.Id"><i class="fa fa-archive mr-2" aria-hidden="true"></i>Inventory</a>
        <a class="btn btn-secondary btn-sm" asp-page="./AddPurchase" asp-route-id="@Model.Id"><i class="fa fa-plus-circle mr-2" aria-hidden="true"></i>Create purchase</a>

        <div class="card mb-4 py-3 mt-2 border-left-primary">
            <div class="card-body">
                <form method="post">
                    <div class="form-group">
                        <label for="PurchaseDate">Purchase Date</label>
                        <!-- Add an id attribute to the PurchaseDate input field -->
                        <input type="date" class="form-control" id="PurchaseDate" name="PurchaseDate" asp-for="PurchaseRequest.PurchaseDate">
                        <span asp-validation-for="PurchaseRequest.PurchaseDate" class="text-danger"></span>
                    </div>
                    <!-- Shopping Items Section -->
                    <div class="form-group" id="shoppingItems">
                        <label>Shopping Items</label>
                        <div class="shopping-item">
                            <input type="text" class="form-control mb-2" name="Items[0].Title" placeholder="Title" asp-for="PurchaseRequest.Items[0].Title" required>
                            <input type="number" class="form-control mb-2" name="Items[0].Quantity" placeholder="Quantity" asp-for="PurchaseRequest.Items[0].Quantity" min="0.01">
                            <select class="form-control mb-2" name="Items[0].QuantityType" asp-for="PurchaseRequest.Items[0].QuantityType">
                                @foreach (HomeChoreTracker.Portal.Constants.QuantityType type in Enum.GetValues(typeof(HomeChoreTracker.Portal.Constants.QuantityType)))
                                {
                                    <option value="@type">@type</option>
                                }
                            </select>
                            <select class="form-control mb-2" name="Items[0].ProductType" asp-for="PurchaseRequest.Items[0].ProductType">
                                @foreach (HomeChoreTracker.Portal.Constants.ProductType type in Enum.GetValues(typeof(HomeChoreTracker.Portal.Constants.ProductType)))
                                {
                                    <option value="@type">@type</option>
                                }
                            </select>
                            <button type="button" class="btn btn-danger btn-sm" onclick="removeShoppingItem(this)">Remove</button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary mb-2" onclick="addShoppingItem()">Add Shopping Item</button>
                    <button type="submit" class="btn btn-primary">Save Purchase</button>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    // JavaScript function to set today's date as the default value for PurchaseDate input field
    document.addEventListener('DOMContentLoaded', function () {
        var today = new Date().toISOString().split('T')[0];
        document.getElementById('PurchaseDate').value = today;
    });

    function addShoppingItem() {
        var itemCount = document.querySelectorAll('.shopping-item').length;
        var newItemHtml = '<div class="shopping-item">' +
            '<input type="text" class="form-control mb-2" name="Items[' + itemCount + '].Title" placeholder="Title" asp-for="PurchaseRequest.Items[' + itemCount + '].Title" required>' +
            '<input type="number" class="form-control mb-2" name="Items[' + itemCount + '].Quantity" placeholder="Quantity" asp-for="PurchaseRequest.Items[' + itemCount + '].Quantity" min="0.01">' +
            '<select class="form-control mb-2" name="Items[' + itemCount + '].QuantityType" asp-for="PurchaseRequest.Items[' + itemCount + '].QuantityType">';

        // Dynamically generate options for QuantityType dropdown
        var quantityTypeOptions = '';
        var quantityTypes = @Html.Raw(Json.Serialize(Enum.GetNames(typeof(HomeChoreTracker.Portal.Constants.QuantityType))));
        quantityTypes.forEach(function (type) {
            quantityTypeOptions += '<option value="' + type + '">' + type + '</option>';
        });
        newItemHtml += quantityTypeOptions;

        newItemHtml += '</select>' +
            '<select class="form-control mb-2" name="Items[' + itemCount + '].ProductType" asp-for="PurchaseRequest.Items[' + itemCount + '].ProductType">';

        // Dynamically generate options for ProductType dropdown
        var productTypeOptions = '';
        var productTypes = @Html.Raw(Json.Serialize(Enum.GetNames(typeof(HomeChoreTracker.Portal.Constants.ProductType))));
        productTypes.forEach(function (type) {
            productTypeOptions += '<option value="' + type + '">' + type + '</option>';
        });
        newItemHtml += productTypeOptions;

        newItemHtml += '</select>' +
            '<button type="button" class="btn btn-danger btn-sm" onclick="removeShoppingItem(this)">Remove</button>' +
            '</div>';

        document.getElementById('shoppingItems').insertAdjacentHTML('beforeend', newItemHtml);
    }

    function removeShoppingItem(button) {
        button.parentElement.remove();
    }
</script>

